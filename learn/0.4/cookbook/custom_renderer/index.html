<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Dioxus | An elegant GUI library for Rust</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8" />

    <meta name="description" content="An elegant GUI library for Rust, inspired by React. Supports Web, Desktop, SSR, Liveview, and Mobile.">

    <link rel="icon shortcut" type="image/png" href="/static/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/prism/prism.css" />


    <!-- Social meta stuff -->
    <!-- open graph -->
    <meta
      property="og:title"
      content="Dioxus - Reliable Rust apps that run anywhere"
    />

    <meta property="og:type" content="website" />

    <meta
      property="og:description"
      content="An elegant GUI library for Rust, inspired by React. Supports Web, Desktop, SSR, Liveview, and Mobile."
    />

    <meta property="og:url" content="https://dioxuslabs.com/" />

    <meta
      property="og:image"
      content="https://dioxuslabs.com/static/opengraph.png"
    />

    <!-- twitter -->
    <meta
      name="twitter:title"
      content="Dioxus - Reliable Rust apps that run anywhere"
    />
    <meta
      name="twitter:description"
      content="An elegant GUI library for Rust, inspired by React. Supports Web, Desktop, SSR, Liveview, and Mobile."
    />
    <meta
      name="twitter:image"
      content="https://dioxuslabs.com/static/opengraph.png"
    />
    <meta name="twitter:card" content="summary_large_image" />

    <!-- icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EBE72MVZ1B"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-EBE72MVZ1B');
    </script>

    <!-- style stuff -->
    <!-- <link data-trunk rel="css" href="/tailwind.css" /> -->
    <link rel="stylesheet" href="/./tailwind.css" />
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <!-- <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              ghmetal: "#24292f",
              ghdarkmetal: "#161b22",
              ideblack: "#0e1116",
              // ideblack: "#0a0a0a",
              // ideblack: "#0E1116",
            },
            fontFamily: {
              sans: ["Lexend", "sans-serif"],
              // sans: ["Inter var", "sans-serif"],
            },
            boxShadow: {
              "3xl": "0 35px 60px -1ww5px rgba(0, 0, 0, 0.5)",
              cutesy: "0px 0px 40px -5px rgba(255, 255, 255, 0.2)",
              // cutesy: "0px 0px 30px -10px white",
              // cutesy: "0px 0px 30px -10px red",
              pop: "0px 0px 30px -10px rgba(0, 0, 0, 0.5)",
            },
          },
        },

        // "3xl": "0 35px 60px -1ww5px rgba(0, 0, 0, 0.5)",
        // theme: {
        //   extend: {
        //     colors: {
        //       clifford: "#da373d",
        //     },
        //   },
        // },
      };
    </script> -->
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown.min.css"
    />

    <style>
      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 5%;
        /* padding: 45px; */
        list-style: disc;
      }
      /* body {
        font-family: 'Lexend', sans-serif;
      } */

      @media (max-width: 767px) {
        .markdown-body {
          /* padding: 15px; */
        }
      }
    </style>
    <script src="/./static/darktheme.js"></script>
    
  <!-- CANONICAL --><link rel="canonical" href="https://dioxuslabs.com/learn/0.5/cookbook/custom_renderer" /><!-- END CANONICAL --></head>

  <body>
    <div id="main"><div><pre></pre><header class="sticky top-0 z-30 bg-white shadow dark:text-gray-200 dark:bg-ideblack dark:border-b border-stone-600 "><div class="py-3 px-12 max-w-screen-2xl mx-auto flex items-center justify-between text-sm leading-6"><button class="bg-gray-100 rounded-lg p-2 mr-4 lg:hidden my-3 h-10 flex items-center text-lg z-[100] "><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: 24px; color: rgba(0, 0, 0, 0.54); user-select: none;"><!--#-->menu<!--#--></span></button><div class="flex z-50 flex-1"><a href="/" dioxus-prevent-default="onclick" class="flex title-font font-medium items-center text-gray-900" id="" rel="" target=""><img src="https://avatars.githubusercontent.com/u/79236386?s=200&v=4" class="h-5 w-auto"/><span class="ml-3 text-xl dark:text-white font-mono">Dioxus Labs</span></a></div><div class="relative md:w-full max-w-[30rem] xl:max-w-[30rem] 2xl:max-w-[30rem] sm:mx-auto sm:flex-1"><button class="bg-gray-100 rounded-lg px-3 py-3 sm:w-full text-left text-gray-400 my-auto sm:flex sm:flex-row sm:align-middle sm:justify-between"><div class="h-full my-auto flex flex-row align-middle justify-between"><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: 24px; color: rgba(0, 0, 0, 0.54); user-select: none;"><!--#-->search<!--#--></span><span class="hidden sm:block pl-2">Search the docs</span></div><div class="hidden sm:block border border-gray-300 rounded-lg p-1 text-xs text-gray-400">CTRL + /</div></button></div><div class="hidden xl:flex h-full justify-end ml-2 flex-1"><div class="hidden md:flex items-center font-semibold"><nav><ul class="flex items-center space-x-2"><li><a href="/awesome" dioxus-prevent-default="onclick" class="ml-[-3.8em] md:ml-0 md:py-2 md:px-2 hover:text-sky-500 dark:hover:text-sky-400 dark:hover:bg-gray-500 hover:bg-gray-200 rounded text-lg md:text-sm" id="" rel="" target=""><!--#-->Awesome<!--#--></a></li><li><a href="/learn/0.4/" dioxus-prevent-default="onclick" class="ml-[-3.8em] md:ml-0 md:py-2 md:px-2 hover:text-sky-500 dark:hover:text-sky-400 dark:hover:bg-gray-500 hover:bg-gray-200 rounded text-lg md:text-sm" id="" rel="" target=""><!--#-->Docs<!--#--></a></li><li><a href="/blog" dioxus-prevent-default="onclick" class="ml-[-3.8em] md:ml-0 md:py-2 md:px-2 hover:text-sky-500 dark:hover:text-sky-400 dark:hover:bg-gray-500 hover:bg-gray-200 rounded text-lg md:text-sm" id="" rel="" target=""><!--#-->Blog<!--#--></a></li></ul></nav><div class="flex items-center border-l border-gray-200 ml-4 pl-4 dark:border-gray-800"><label class="sr-only" id="headlessui-listbox-label-2">Theme</label><a href="https://discord.gg/XgGxMSkvUM" dioxus-prevent-default="" class="block text-gray-400 hover:text-gray-500 dark:hover:text-gray-300" id="" rel="noopener noreferrer" target=""><span class="sr-only">Dioxus on Discord</span><svg width="24" height="24" viewBox="0 -28.5 256 256" preserveAspectRatio="xMidYMid"><g><path d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z" fill="currentColor" fill-rule="nonzero"></path></g></svg></a><a href="https://github.com/dioxuslabs/dioxus" dioxus-prevent-default="" class="ml-4 block text-gray-400 hover:text-gray-500 dark:hover:text-gray-300" id="" rel="noopener noreferrer" target=""><span class="sr-only">Dioxus on GitHub</span><svg class="w-5 h-5" viewBox="0 0 16 16" aria-hidden="true" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a></div><div class="flex items-center border-l border-gray-200 ml-4 pl-6 dark:border-gray-800"><label class="sr-only" id="headlessui-listbox-label-2">Theme</label><a href="/deploy" dioxus-prevent-default="onclick" class="md:ml-0 md:py-2 md:px-3 bg-blue-500 ml-4 text-lg md:text-sm text-white rounded font-semibold" id="" rel="" target="">DEPLOY</a><pre></pre></div></div></div></div></header><div class="w-full pt-12 text-sm dark:bg-ideblack" style="min-height:100vh;"><div class="max-w-screen-2xl flex flex-row justify-between mx-auto dark:text-white"><nav class="bg-white dark:bg-ideblack lg:bg-inherit pl-6 pb-32 z-20 text-base lg:block sticky top-28 lg:-ml-3.5 w-[calc(100%-1rem)] md:w-60 h-screen max-h-screen lg:text-[13px] text-navy content-start overflow-y-auto leading-5   hidden"><div class="pb-4"><a href="/learn/0.4/" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Introduction<!--#--></h2></a><ul class="pl-2"><pre></pre></ul></div><div class="pb-4"><a href="/learn/0.4/getting_started" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Getting Started<!--#--></h2></a><ul class="pl-2"><a href="/learn/0.4/getting_started/choosing_a_web_renderer" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Choosing A Web Renderer<!--#--></li></a><a href="/learn/0.4/getting_started/wasm" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Web<!--#--></li></a><a href="/learn/0.4/getting_started/liveview" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Liveview<!--#--></li></a><a href="/learn/0.4/getting_started/fullstack" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Fullstack<!--#--></li></a><a href="/learn/0.4/getting_started/desktop" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Desktop<!--#--></li></a><a href="/learn/0.4/getting_started/mobile" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Mobile<!--#--></li></a><a href="/learn/0.4/getting_started/tui" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Terminal UI<!--#--></li></a></ul></div><div class="pb-4"><a href="/learn/0.4/guide" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Guide<!--#--></h2></a><ul class="pl-2"><a href="/learn/0.4/guide/your_first_component" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Your First Component<!--#--></li></a><a href="/learn/0.4/guide/state" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->State<!--#--></li></a><a href="/learn/0.4/guide/data_fetching" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Data Fetching<!--#--></li></a><a href="/learn/0.4/guide/full_code" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Full Code<!--#--></li></a></ul></div><div class="pb-4"><a href="/learn/0.4/reference" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Reference<!--#--></h2></a><ul class="pl-2"><a href="/learn/0.4/reference/rsx" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->RSX<!--#--></li></a><a href="/learn/0.4/reference/components" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Components<!--#--></li></a><a href="/learn/0.4/reference/component_props" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Props<!--#--></li></a><a href="/learn/0.4/reference/event_handlers" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Event Handlers<!--#--></li></a><a href="/learn/0.4/reference/hooks" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Hooks<!--#--></li></a><a href="/learn/0.4/reference/user_input" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->User Input<!--#--></li></a><a href="/learn/0.4/reference/context" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Context<!--#--></li></a><a href="/learn/0.4/reference/dynamic_rendering" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Dynamic Rendering<!--#--></li></a><a href="/learn/0.4/reference/router" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Routing<!--#--></li></a><a href="/learn/0.4/reference/use_future" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->UseFuture<!--#--></li></a><a href="/learn/0.4/reference/use_coroutine" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->UseCoroutine<!--#--></li></a><a href="/learn/0.4/reference/spawn" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Spawn<!--#--></li></a><a href="/learn/0.4/reference/desktop" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Desktop<!--#--></li></a><a href="/learn/0.4/reference/web" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Web<!--#--></li></a><a href="/learn/0.4/reference/ssr" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->SSR<!--#--></li></a><a href="/learn/0.4/reference/liveview" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Liveview<!--#--></li></a><li class="m-1 rounded-md ml-[-1px] hover:bg-gray-200 hover:dark:bg-gray-800"><button><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: inherit; color: gray; user-select: none;"><!--#-->chevron_right<!--#--></span></button><a href="/learn/0.4/reference/fullstack" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><!--#-->Fullstack<!--#--></a></li><pre></pre></ul></div><div class="pb-4"><a href="/learn/0.4/router" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Router<!--#--></h2></a><ul class="pl-2"><li class="m-1 rounded-md ml-[-1px] hover:bg-gray-200 hover:dark:bg-gray-800"><button><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: inherit; color: gray; user-select: none;"><!--#-->chevron_right<!--#--></span></button><a href="/learn/0.4/router/example" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><!--#-->Example Project<!--#--></a></li><pre></pre><li class="m-1 rounded-md ml-[-1px] hover:bg-gray-200 hover:dark:bg-gray-800"><button><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: inherit; color: gray; user-select: none;"><!--#-->chevron_right<!--#--></span></button><a href="/learn/0.4/router/reference" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><!--#-->Reference<!--#--></a></li><pre></pre></ul></div><div class="pb-4"><a href="/learn/0.4/cookbook" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Cookbook<!--#--></h2></a><ul class="pl-2"><a href="/learn/0.4/cookbook/publishing" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Publishing<!--#--></li></a><a href="/learn/0.4/cookbook/antipatterns" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Anti-patterns<!--#--></li></a><a href="/learn/0.4/cookbook/error_handling" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Error Handling<!--#--></li></a><li class="m-1 rounded-md ml-[-1px] hover:bg-gray-200 hover:dark:bg-gray-800"><button><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: inherit; color: gray; user-select: none;"><!--#-->chevron_right<!--#--></span></button><a href="/learn/0.4/cookbook/integrations" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><!--#-->Integrations<!--#--></a></li><pre></pre><li class="m-1 rounded-md ml-[-1px] hover:bg-gray-200 hover:dark:bg-gray-800"><button><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: inherit; color: gray; user-select: none;"><!--#-->chevron_right<!--#--></span></button><a href="/learn/0.4/cookbook/state" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><!--#-->State Management<!--#--></a></li><pre></pre><a href="/learn/0.4/cookbook/testing" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Testing<!--#--></li></a><a href="/learn/0.4/cookbook/examples" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Examples<!--#--></li></a><a href="/learn/0.4/cookbook/tailwind" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Tailwind<!--#--></li></a><a href="/learn/0.4/cookbook/custom_renderer" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 bg-gray-200 dark:bg-gray-800"><!--#-->Custom Renderer<!--#--></li></a><a href="/learn/0.4/cookbook/optimizing" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Optimizing<!--#--></li></a></ul></div><div class="pb-4"><a href="/learn/0.4/CLI" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->CLI<!--#--></h2></a><ul class="pl-2"><a href="/learn/0.4/CLI/installation" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Installation<!--#--></li></a><a href="/learn/0.4/CLI/creating" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Create a Project<!--#--></li></a><a href="/learn/0.4/CLI/configure" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Configure Project<!--#--></li></a><a href="/learn/0.4/CLI/translate" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Translate HTML<!--#--></li></a></ul></div><div class="pb-4"><a href="/learn/0.4/contributing" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Contributing<!--#--></h2></a><ul class="pl-2"><a href="/learn/0.4/contributing/project_structure" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Project Structure<!--#--></li></a><a href="/learn/0.4/contributing/walkthrough_readme" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Walkthrough of Internals<!--#--></li></a><a href="/learn/0.4/contributing/guiding_principles" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Guiding Principles<!--#--></li></a><a href="/learn/0.4/contributing/roadmap" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Roadmap<!--#--></li></a></ul></div><div class="pb-4"><a href="/learn/0.4/migration" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><h2 class="font-semibold"><!--#-->Migration<!--#--></h2></a><ul class="pl-2"><a href="/learn/0.4/migration/router" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Router<!--#--></li></a><a href="/learn/0.4/migration/hot_reload" dioxus-prevent-default="onclick" class="" id="" rel="" target=""><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800 "><!--#-->Hot Reload<!--#--></li></a></ul></div></nav><section class="text-gray-600 body-font overflow-hidden dark:bg-ideblack container pt-6 pb-12"><div class="-py-8 "><div class="flex w-full mb-20 flex-wrap list-none"><style>.markdown-body ul { list-style: disc; }.markdown-body ol { list-style: decimal; }.markdown-body li { display: list-item; }.markdown-body button { display: inline-block; background-color: rgba(209, 213, 219, 0.3); border-radius: 0.25rem; padding: 0.25rem 0.5rem; border: 1px solid; margin: 0.25rem; }.markdown-body .header { color: inherit }</style><article class="markdown-body pt-1"><h1 id="custom-renderer"><a class="header" href="#custom-renderer">Custom Renderer</a></h1><p>Dioxus is an incredibly portable framework for UI development. The lessons, knowledge, hooks, and components you acquire over time can always be used for future projects. However, sometimes those projects cannot leverage a supported renderer or you need to implement your own better renderer.</p><p>Great news: the design of the renderer is entirely up to you! We provide suggestions and inspiration with the 1st party renderers, but only really require processing <code>Mutations</code> and sending <code>UserEvents</code>.</p><h2 id="the-specifics"><a class="header" href="#the-specifics">The specifics:</a></h2><p>Implementing the renderer is fairly straightforward. The renderer needs to:</p><ol><li>Handle the stream of edits generated by updates to the virtual DOM</li><li>Register listeners and pass events into the virtual DOM&#x27;s event system</li></ol><p>Essentially, your renderer needs to process edits and generate events to update the VirtualDOM. From there, you&#x27;ll have everything needed to render the VirtualDOM to the screen.</p><p>Internally, Dioxus handles the tree relationship, diffing, memory management, and the event system, leaving as little as possible required for renderers to implement themselves.</p><p>For reference, check out the <a href="https://github.com/DioxusLabs/dioxus/tree/master/packages/interpreter">javascript interpreter</a> or <a href="https://github.com/DioxusLabs/dioxus/tree/master/packages/dioxus-tui">tui renderer</a> as a starting point for your custom renderer.</p><h2 id="templates"><a class="header" href="#templates">Templates</a></h2><p>Dioxus is built around the concept of <a href="https://docs.rs/dioxus-core/latest/dioxus_core/prelude/struct.Template.html">Templates</a>. Templates describe a UI tree known at compile time with dynamic parts filled at runtime. This is useful internally to make skip diffing static nodes, but it is also useful for the renderer to reuse parts of the UI tree. This can be useful for things like a list of items. Each item could contain some static parts and some dynamic parts. The renderer can use the template to create a static part of the UI once, clone it for each element in the list, and then fill in the dynamic parts.</p><h2 id="mutations"><a class="header" href="#mutations">Mutations</a></h2><p>The <code>Mutation</code> type is a serialized enum that represents an operation that should be applied to update the UI. The variants roughly follow this set:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">enum </span><span style="color:#c0c5ce;">Mutation {
</span><span style="color:#c0c5ce;">	AppendChildren,
</span><span style="color:#c0c5ce;">	AssignId,
</span><span style="color:#c0c5ce;">	CreatePlaceholder,
</span><span style="color:#c0c5ce;">	CreateTextNode,
</span><span style="color:#c0c5ce;">	HydrateText,
</span><span style="color:#c0c5ce;">	LoadTemplate,
</span><span style="color:#c0c5ce;">	ReplaceWith,
</span><span style="color:#c0c5ce;">	ReplacePlaceholder,
</span><span style="color:#c0c5ce;">	InsertAfter,
</span><span style="color:#c0c5ce;">	InsertBefore,
</span><span style="color:#c0c5ce;">	SetAttribute,
</span><span style="color:#c0c5ce;">	SetText,
</span><span style="color:#c0c5ce;">	NewEventListener,
</span><span style="color:#c0c5ce;">	RemoveEventListener,
</span><span style="color:#c0c5ce;">	Remove,
</span><span style="color:#c0c5ce;">	PushRoot,
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>The Dioxus diffing mechanism operates as a <a href="https://en.wikipedia.org/wiki/Stack_machine">stack machine</a> where the <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.LoadTemplate">LoadTemplate</a>, <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.CreatePlaceholder">CreatePlaceholder</a>, and <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.CreateTextNode">CreateTextNode</a> mutations pushes a new &quot;real&quot; DOM node onto the stack and <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.AppendChildren">AppendChildren</a>, <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.InsertAfter">InsertAfter</a>, <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.InsertBefore">InsertBefore</a>, <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.ReplacePlaceholder">ReplacePlaceholder</a>, and <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.ReplaceWith">ReplaceWith</a> all remove nodes from the stack.</p><h2 id="node-storage"><a class="header" href="#node-storage">Node storage</a></h2><p>Dioxus saves and loads elements with IDs. Inside the VirtualDOM, this is just tracked as as a u64.</p><p>Whenever a <code>CreateElement</code> edit is generated during diffing, Dioxus increments its node counter and assigns that new element its current NodeCount. The RealDom is responsible for remembering this ID and pushing the correct node when id is used in a mutation. Dioxus reclaims the IDs of elements when removed. To stay in sync with Dioxus you can use a sparse Vec (Vec&lt;Option&gt;) with possibly unoccupied items. You can use the ids as indexes into the Vec for elements, and grow the Vec when an id does not exist.</p><h3 id="an-example"><a class="header" href="#an-example">An Example</a></h3><p>For the sake of understanding, let&#x27;s consider this example – a very simple UI declaration:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">rsx!( h1 {&quot;</span><span style="color:#a3be8c;">count: {x}</span><span style="color:#c0c5ce;">&quot;} )
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><h4 id="building-templates"><a class="header" href="#building-templates">Building Templates</a></h4><p>The above rsx will create a template that contains one static h1 tag and a placeholder for a dynamic text node. The template contains the static parts of the UI, and ids for the dynamic parts along with the paths to access them.</p><p>The template will look something like this:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">Template {
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">// Some id that is unique for the entire project
</span><span style="color:#c0c5ce;">	name: &quot;</span><span style="color:#a3be8c;">main.rs:1:1:0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">// The root nodes of the template
</span><span style="color:#c0c5ce;">	roots: &amp;[
</span><span style="color:#c0c5ce;">		TemplateNode::Element {
</span><span style="color:#c0c5ce;">			tag: &quot;</span><span style="color:#a3be8c;">h1</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">			namespace: None,
</span><span style="color:#c0c5ce;">			attrs: &amp;[],
</span><span style="color:#c0c5ce;">			children: &amp;[
</span><span style="color:#c0c5ce;">				TemplateNode::DynamicText {
</span><span style="color:#c0c5ce;">					id: </span><span style="color:#d08770;">0
</span><span style="color:#c0c5ce;">				},
</span><span style="color:#c0c5ce;">			],
</span><span style="color:#c0c5ce;">		}
</span><span style="color:#c0c5ce;">	],
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">// the path to each of the dynamic nodes
</span><span style="color:#c0c5ce;">	node_paths: &amp;[
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the path to dynamic node with a id of 0
</span><span style="color:#c0c5ce;">		&amp;[
</span><span style="color:#c0c5ce;">			</span><span style="color:#65737e;">// on the first root node
</span><span style="color:#c0c5ce;">			</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">			</span><span style="color:#65737e;">// the first child of the root node
</span><span style="color:#c0c5ce;">			</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">		]
</span><span style="color:#c0c5ce;">	],
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">// the path to each of the dynamic attributes
</span><span style="color:#c0c5ce;">	attr_paths: &amp;</span><span style="color:#b48ead;">&#39;a </span><span style="color:#c0c5ce;">[&amp;</span><span style="color:#b48ead;">&#39;a </span><span style="color:#c0c5ce;">[</span><span style="color:#b48ead;">u8</span><span style="color:#c0c5ce;">]],
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><blockquote><p>For more detailed docs about the structure of templates see the <a href="https://docs.rs/dioxus-core/latest/dioxus_core/prelude/struct.Template.html">Template api docs</a></p></blockquote><p>This template will be sent to the renderer in the <a href="https://docs.rs/dioxus-core/latest/dioxus_core/struct.Mutations.html#structfield.templates">list of templates</a> supplied with the mutations the first time it is used. Any time the renderer encounters a <a href="https://docs.rs/dioxus-core/latest/dioxus_core/enum.Mutation.html#variant.LoadTemplate">LoadTemplate</a> mutation after this, it should clone the template and store it in the given id.</p><p>For dynamic nodes and dynamic text nodes, a placeholder node should be created and inserted into the UI so that the node can be modified later.</p><p>In HTML renderers, this template could look like this:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">&lt;h1&gt;&quot;&quot;&lt;/h1&gt;
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><h4 id="applying-mutations"><a class="header" href="#applying-mutations">Applying Mutations</a></h4><p>After the renderer has created all of the new templates, it can begin to process the mutations.</p><p>When the renderer starts, it should contain the Root node on the stack and store the Root node with an id of 0. The Root node is the top-level node of the UI. In HTML, this is the <code>&lt;div id=&quot;main&quot;&gt;</code> element.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">instructions: []
</span><span style="color:#c0c5ce;">stack: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">nodes: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">]
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>The first mutation is a <code>LoadTemplate</code> mutation. This tells the renderer to load a root from the template with the given id. The renderer will then push the root node of the template onto the stack and store it with an id for later. In this case, the root node is an h1 element.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">instructions: [
</span><span style="color:#c0c5ce;">	LoadTemplate {
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the id of the template
</span><span style="color:#c0c5ce;">		name: &quot;</span><span style="color:#a3be8c;">main.rs:1:1:0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the index of the root node in the template
</span><span style="color:#c0c5ce;">		index: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the id to store
</span><span style="color:#c0c5ce;">		id: ElementId(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">),
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">stack: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">	&lt;h1&gt;&quot;&quot;&lt;/h1&gt;,
</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">nodes: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">	&lt;h1&gt;&quot;&quot;&lt;/h1&gt;,
</span><span style="color:#c0c5ce;">]
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>Next, Dioxus will create the dynamic text node. The diff algorithm decides that this node needs to be created, so Dioxus will generate the Mutation <code>HydrateText</code>. When the renderer receives this instruction, it will navigate to the placeholder text node in the template and replace it with the new text.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">instructions: [
</span><span style="color:#c0c5ce;">	LoadTemplate {
</span><span style="color:#c0c5ce;">		name: &quot;</span><span style="color:#a3be8c;">main.rs:1:1:0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">		index: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">		id: ElementId(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">),
</span><span style="color:#c0c5ce;">	},
</span><span style="color:#c0c5ce;">	HydrateText {
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the id to store the text node
</span><span style="color:#c0c5ce;">		id: ElementId(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">),
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the text to set
</span><span style="color:#c0c5ce;">		text: &quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">stack: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">	&lt;h1&gt;&quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;&lt;/h1&gt;,
</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">nodes: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">	&lt;h1&gt;&quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;&lt;/h1&gt;,
</span><span style="color:#c0c5ce;">	&quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">]
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>Remember, the h1 node is not attached to anything (it is unmounted) so Dioxus needs to generate an Edit that connects the h1 node to the Root. It depends on the situation, but in this case, we use <code>AppendChildren</code>. This pops the text node off the stack, leaving the Root element as the next element on the stack.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">instructions: [
</span><span style="color:#c0c5ce;">	LoadTemplate {
</span><span style="color:#c0c5ce;">		name: &quot;</span><span style="color:#a3be8c;">main.rs:1:1:0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">		index: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">		id: ElementId(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">),
</span><span style="color:#c0c5ce;">	},
</span><span style="color:#c0c5ce;">	HydrateText {
</span><span style="color:#c0c5ce;">		id: ElementId(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">),
</span><span style="color:#c0c5ce;">		text: &quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">	},
</span><span style="color:#c0c5ce;">	AppendChildren {
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the id of the parent node
</span><span style="color:#c0c5ce;">		id: ElementId(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">),
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// the number of nodes to pop off the stack and append
</span><span style="color:#c0c5ce;">		m: </span><span style="color:#d08770;">1
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">stack: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">nodes: [
</span><span style="color:#c0c5ce;">	RootNode,
</span><span style="color:#c0c5ce;">	&lt;h1&gt;&quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;&lt;/h1&gt;,
</span><span style="color:#c0c5ce;">	&quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">]
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>Over time, our stack looked like this:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">[Root]
</span><span style="color:#c0c5ce;">[Root, &lt;h1&gt;&quot;&quot;&lt;/h1&gt;]
</span><span style="color:#c0c5ce;">[Root, &lt;h1&gt;&quot;</span><span style="color:#a3be8c;">count: 0</span><span style="color:#c0c5ce;">&quot;&lt;/h1&gt;]
</span><span style="color:#c0c5ce;">[Root]
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>Conveniently, this approach completely separates the Virtual DOM and the Real DOM. Additionally, these edits are serializable, meaning we can even manage UIs across a network connection. This little stack machine and serialized edits make Dioxus independent of platform specifics.</p><p>Dioxus is also really fast. Because Dioxus splits the diff and patch phase, it&#x27;s able to make all the edits to the RealDOM in a very short amount of time (less than a single frame) making rendering very snappy. It also allows Dioxus to cancel large diffing operations if higher priority work comes in while it&#x27;s diffing.</p><p>This little demo serves to show exactly how a Renderer would need to process a mutation stream to build UIs.</p><h2 id="event-loop"><a class="header" href="#event-loop">Event loop</a></h2><p>Like most GUIs, Dioxus relies on an event loop to progress the VirtualDOM. The VirtualDOM itself can produce events as well, so it&#x27;s important for your custom renderer can handle those too.</p><p>The code for the WebSys implementation is straightforward, so we&#x27;ll add it here to demonstrate how simple an event loop is:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">pub</span><span style="color:#c0c5ce;"> async </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">run</span><span style="color:#c0c5ce;">(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">) -&gt; dioxus_core::error::Result&lt;()&gt; {
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">// Push the body element onto the WebsysDom&#39;s stack machine
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> websys_dom = </span><span style="color:#b48ead;">crate</span><span style="color:#c0c5ce;">::new::WebsysDom::new(</span><span style="color:#96b5b4;">prepare_websys_dom</span><span style="color:#c0c5ce;">());
</span><span style="color:#c0c5ce;">	websys_dom.stack.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(root_node);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">// Rebuild or hydrate the virtualdom
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> mutations = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.internal_dom.</span><span style="color:#96b5b4;">rebuild</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">	websys_dom.</span><span style="color:#96b5b4;">apply_mutations</span><span style="color:#c0c5ce;">(mutations);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">// Wait for updates from the real dom and progress the virtual dom
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">loop </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">		</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> user_input_future = websys_dom.</span><span style="color:#96b5b4;">wait_for_event</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">		</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> internal_event_future = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.internal_dom.</span><span style="color:#96b5b4;">wait_for_work</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">		</span><span style="color:#b48ead;">match </span><span style="color:#96b5b4;">select</span><span style="color:#c0c5ce;">(user_input_future, internal_event_future).await {
</span><span style="color:#c0c5ce;">			Either::Left((_, _)) =&gt; {
</span><span style="color:#c0c5ce;">				</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> mutations = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.internal_dom.</span><span style="color:#96b5b4;">work_with_deadline</span><span style="color:#c0c5ce;">(|| </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">				websys_dom.</span><span style="color:#96b5b4;">apply_mutations</span><span style="color:#c0c5ce;">(mutations);
</span><span style="color:#c0c5ce;">			},
</span><span style="color:#c0c5ce;">			Either::Right((event, _)) =&gt; websys_dom.</span><span style="color:#96b5b4;">handle_event</span><span style="color:#c0c5ce;">(event),
</span><span style="color:#c0c5ce;">		}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">		</span><span style="color:#65737e;">// render
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>It&#x27;s important to decode what the real events are for your event system into Dioxus&#x27; synthetic event system (synthetic meaning abstracted). This simply means matching your event type and creating a Dioxus <code>UserEvent</code> type. Right now, the virtual event system is modeled almost entirely around the HTML spec, but we are interested in slimming it down.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">virtual_event_from_websys_event</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">event</span><span style="color:#c0c5ce;">: &amp;web_sys::Event) -&gt; VirtualEvent {
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> event.</span><span style="color:#96b5b4;">type_</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">as_str</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">		&quot;</span><span style="color:#a3be8c;">keydown</span><span style="color:#c0c5ce;">&quot; =&gt; {
</span><span style="color:#c0c5ce;">			</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> event: web_sys::KeyboardEvent = event.</span><span style="color:#96b5b4;">clone</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">dyn_into</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">			UserEvent::KeyboardEvent(UserEvent {
</span><span style="color:#c0c5ce;">				scope_id: None,
</span><span style="color:#c0c5ce;">				priority: EventPriority::Medium,
</span><span style="color:#c0c5ce;">				name: &quot;</span><span style="color:#a3be8c;">keydown</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">				</span><span style="color:#65737e;">// This should be whatever element is focused
</span><span style="color:#c0c5ce;">				element: Some(ElementId(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)),
</span><span style="color:#c0c5ce;">				data: Arc::new(KeyboardData{
</span><span style="color:#c0c5ce;">					char_code: event.</span><span style="color:#96b5b4;">char_code</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					key: event.</span><span style="color:#96b5b4;">key</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					key_code: event.</span><span style="color:#96b5b4;">key_code</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					alt_key: event.</span><span style="color:#96b5b4;">alt_key</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					ctrl_key: event.</span><span style="color:#96b5b4;">ctrl_key</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					meta_key: event.</span><span style="color:#96b5b4;">meta_key</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					shift_key: event.</span><span style="color:#96b5b4;">shift_key</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					location: event.</span><span style="color:#96b5b4;">location</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					repeat: event.</span><span style="color:#96b5b4;">repeat</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">					which: event.</span><span style="color:#96b5b4;">which</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">				})
</span><span style="color:#c0c5ce;">			})
</span><span style="color:#c0c5ce;">		}
</span><span style="color:#c0c5ce;">		_ =&gt; todo!()
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><h2 id="custom-raw-elements"><a class="header" href="#custom-raw-elements">Custom raw elements</a></h2><p>If you need to go as far as relying on custom elements/attributes for your renderer – you totally can. This still enables you to use Dioxus&#x27; reactive nature, component system, shared state, and other features, but will ultimately generate different nodes. All attributes and listeners for the HTML and SVG namespace are shuttled through helper structs that essentially compile away. You can drop in your elements any time you want, with little hassle. However, you must be sure your renderer can handle the new namespace.</p><p>For more examples and information on how to create custom namespaces, see the <a href="https://github.com/DioxusLabs/dioxus/blob/master/packages/html/README.md#how-to-extend-it"><code>dioxus_html</code> crate</a>.</p><h1 id="native-core"><a class="header" href="#native-core">Native Core</a></h1><p>If you are creating a renderer in rust, the <a href="https://github.com/DioxusLabs/dioxus/tree/master/packages/native-core">native-core</a> crate provides some utilities to implement a renderer. It provides an abstraction over Mutations and Templates and contains helpers that can handle the layout and text editing for you.</p><h2 id="the-realdom"><a class="header" href="#the-realdom">The RealDom</a></h2><p>The <code>RealDom</code> is a higher-level abstraction over updating the Dom. It uses an entity component system to manage the state of nodes. This system allows you to modify insert and modify arbitrary components on nodes. On top of this, the RealDom provides a way to manage a tree of nodes, and the State trait provides a way to automatically add and update these components when the tree is modified. It also provides a way to apply <code>Mutations</code> to the RealDom.</p><h3 id="example"><a class="header" href="#example">Example</a></h3><p>Let&#x27;s build a toy renderer with borders, size, and text color.Before we start let&#x27;s take a look at an example element we can render:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">cx.</span><span style="color:#96b5b4;">render</span><span style="color:#c0c5ce;">(rsx!{
</span><span style="color:#c0c5ce;">	div{
</span><span style="color:#c0c5ce;">		color: &quot;</span><span style="color:#a3be8c;">red</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">		p{
</span><span style="color:#c0c5ce;">			border: &quot;</span><span style="color:#a3be8c;">1px solid black</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">			&quot;</span><span style="color:#a3be8c;">hello world</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">		}
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">})
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>In this tree, the color depends on the parent&#x27;s color. The layout depends on the children&#x27;s layout, the current text, and the text size. The border depends on only the current node.</p><p>In the following diagram arrows represent dataflow:</p><p><a href="https://mermaid.live/edit#pako:eNqllV1vgjAUhv8K6W4wkQVa2QdLdrHsdlfukmSptEhjoaSWqTH-9xVwONAKst70g5739JzzlO5BJAgFAYi52EQJlsr6fAszS7d1sVhKnCdWJDJFt6peLVs5-9owohK7HFrVcFJ_pxnpmK8VVvRkTJikkWIiaxy1dhP23bUwW1WW5WbPrrqJ4ziR4EJ6dtVN2ls5y1ZztePUcrWZFCvqVEcPPDffvlyS1XoLIQnVgnVvVPR6FU9Zc-6dV453ojjOPbuetRJ57gIeXQR3cez7rjtteZyZQ2j5MqmjqwE0ZW0VKx9RKtgpFewp1aw3sXXFy6TWgiYlv8mfq1scD8ofbBCAfQg8_AMBOAyBxzEIwA4CxgQ99QbQkjnD2KT7_CfxGF8_9WXQEsq5sDZCcjICOXRCri4h6r3NA38Q6Jdi1EOx5w3DGDYYI6MUvJFjM3VoGHUeGoMd6mBnDmh2E3fo7O4Yhf0x4OkBmIKUyhQzol_GfbkcApXQlIYg0EOC5SoEYXbQ-3ChxHyXRSBQsqBTUOREx_7OsAY3BUGM-VqvUsKUkB_1U6vf05gtweEHTk4_HQ"><img src="https://mermaid.ink/img/pako:eNqllV1vgjAUhv8K6W4wkQVa2QdLdrHsdlfukmSptEhjoaSWqTH-9xVwONAKst70g5739JzzlO5BJAgFAYi52EQJlsr6fAszS7d1sVhKnCdWJDJFt6peLVs5-9owohK7HFrVcFJ_pxnpmK8VVvRkTJikkWIiaxy1dhP23bUwW1WW5WbPrrqJ4ziR4EJ6dtVN2ls5y1ZztePUcrWZFCvqVEcPPDffvlyS1XoLIQnVgnVvVPR6FU9Zc-6dV453ojjOPbuetRJ57gIeXQR3cez7rjtteZyZQ2j5MqmjqwE0ZW0VKx9RKtgpFewp1aw3sXXFy6TWgiYlv8mfq1scD8ofbBCAfQg8_AMBOAyBxzEIwA4CxgQ99QbQkjnD2KT7_CfxGF8_9WXQEsq5sDZCcjICOXRCri4h6r3NA38Q6Jdi1EOx5w3DGDYYI6MUvJFjM3VoGHUeGoMd6mBnDmh2E3fo7O4Yhf0x4OkBmIKUyhQzol_GfbkcApXQlIYg0EOC5SoEYXbQ-3ChxHyXRSBQsqBTUOREx_7OsAY3BUGM-VqvUsKUkB_1U6vf05gtweEHTk4_HQ?type=png" alt="" title=""/></a></p><p>To help in building a Dom, native-core provides the State trait and a RealDom struct. The State trait provides a way to describe how states in a node depend on other states in its relatives. By describing how to update a single node from its relations, native-core will derive a way to update the states of all nodes for you. Once you have a state you can provide it as a generic to RealDom. RealDom provides all of the methods to interact and update your new dom.</p><p>Native Core cannot create all of the required methods for the State trait, but it can derive some of them. To implement the State trait, you must implement the following methods and let the <code>#[partial_derive_state]</code> macro handle the rest:</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#65737e;">// All states must derive Component (https://docs.rs/shipyard/latest/shipyard/derive.Component.html)
</span><span style="color:#65737e;">// They also must implement Default or provide a custom implementation of create in the State trait
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">derive</span><span style="color:#c0c5ce;">(Default, Component)]
</span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">MyState;
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;">/// Derive some of the boilerplate for the State implementation
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">partial_derive_state</span><span style="color:#c0c5ce;">]
</span><span style="color:#b48ead;">impl </span><span style="color:#c0c5ce;">State </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">MyState {
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// The states of the parent nodes this state depends on
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ParentDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// The states of the child nodes this state depends on
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ChildDependencies = (</span><span style="color:#b48ead;">Self</span><span style="color:#c0c5ce;">,);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// The states of the current node this state depends on
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">NodeDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// The parts of the current text, element, or placeholder node in the tree that this state depends on
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">NODE_MASK</span><span style="color:#c0c5ce;">: NodeMaskBuilder&lt;</span><span style="color:#b48ead;">&#39;static</span><span style="color:#c0c5ce;">&gt; = NodeMaskBuilder::new();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// How to update the state of the current node based on the state of the parent nodes, child nodes, and the current node
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// Returns true if the node was updated and false if the node was not updated
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">update</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;(
</span><span style="color:#c0c5ce;">        &amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// The view of the current node limited to the parts this state depends on
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_node_view</span><span style="color:#c0c5ce;">: NodeView&lt;()&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// The state of the current node that this state depends on
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_node</span><span style="color:#c0c5ce;">: &lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">NodeDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// The state of the parent nodes that this state depends on
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_parent</span><span style="color:#c0c5ce;">: Option&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ParentDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// The state of the child nodes that this state depends on
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_children</span><span style="color:#c0c5ce;">: Vec&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ChildDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// The context of the current node used to pass global state into the tree
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_context</span><span style="color:#c0c5ce;">: &amp;SendAnyMap,
</span><span style="color:#c0c5ce;">    ) -&gt; </span><span style="color:#b48ead;">bool </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">        todo!()
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// partial_derive_state will generate a default implementation of all the other methods
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>Lets take a look at how to implement the State trait for a simple renderer.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">FontSize(</span><span style="color:#b48ead;">f64</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;">// All states need to derive Component
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">derive</span><span style="color:#c0c5ce;">(Default, Debug, Copy, Clone, Component)]
</span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">Size(</span><span style="color:#b48ead;">f64</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">f64</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;">/// Derive some of the boilerplate for the State implementation
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">partial_derive_state</span><span style="color:#c0c5ce;">]
</span><span style="color:#b48ead;">impl </span><span style="color:#c0c5ce;">State </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">Size {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ParentDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// The size of the current node depends on the size of its children
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ChildDependencies = (</span><span style="color:#b48ead;">Self</span><span style="color:#c0c5ce;">,);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">NodeDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// Size only cares about the width, height, and text parts of the current node
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">NODE_MASK</span><span style="color:#c0c5ce;">: NodeMaskBuilder&lt;</span><span style="color:#b48ead;">&#39;static</span><span style="color:#c0c5ce;">&gt; = NodeMaskBuilder::new()
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// Get access to the width and height attributes
</span><span style="color:#c0c5ce;">        .</span><span style="color:#96b5b4;">with_attrs</span><span style="color:#c0c5ce;">(AttributeMaskBuilder::Some(&amp;[&quot;</span><span style="color:#a3be8c;">width</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">height</span><span style="color:#c0c5ce;">&quot;]))
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// Get access to the text of the node
</span><span style="color:#c0c5ce;">        .</span><span style="color:#96b5b4;">with_text</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">update</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;(
</span><span style="color:#c0c5ce;">        &amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">node_view</span><span style="color:#c0c5ce;">: NodeView&lt;()&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_node</span><span style="color:#c0c5ce;">: &lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">NodeDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_parent</span><span style="color:#c0c5ce;">: Option&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ParentDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">children</span><span style="color:#c0c5ce;">: Vec&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ChildDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">context</span><span style="color:#c0c5ce;">: &amp;SendAnyMap,
</span><span style="color:#c0c5ce;">    ) -&gt; </span><span style="color:#b48ead;">bool </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> font_size = context.get::&lt;FontSize&gt;().</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">().</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> width;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> height;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if let </span><span style="color:#c0c5ce;">Some(text) = node_view.</span><span style="color:#96b5b4;">text</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// if the node has text, use the text to size our object
</span><span style="color:#c0c5ce;">            width = text.</span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">() as </span><span style="color:#b48ead;">f64 </span><span style="color:#c0c5ce;">* font_size;
</span><span style="color:#c0c5ce;">            height = font_size;
</span><span style="color:#c0c5ce;">        } </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// otherwise, the size is the maximum size of the children
</span><span style="color:#c0c5ce;">            width = children
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">iter</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">map</span><span style="color:#c0c5ce;">(|(</span><span style="color:#bf616a;">item</span><span style="color:#c0c5ce;">,)| item.</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">reduce</span><span style="color:#c0c5ce;">(|</span><span style="color:#bf616a;">accum</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">item</span><span style="color:#c0c5ce;">| </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> accum &gt;= item { accum } </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">{ item })
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">unwrap_or</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            height = children
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">iter</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">map</span><span style="color:#c0c5ce;">(|(</span><span style="color:#bf616a;">item</span><span style="color:#c0c5ce;">,)| item.</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">reduce</span><span style="color:#c0c5ce;">(|</span><span style="color:#bf616a;">accum</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">item</span><span style="color:#c0c5ce;">| </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> accum &gt;= item { accum } </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">{ item })
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">unwrap_or</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// if the node contains a width or height attribute it overrides the other size
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;"> a in node_view.</span><span style="color:#96b5b4;">attributes</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">into_iter</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">flatten</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">match </span><span style="color:#c0c5ce;">&amp;*a.attribute.name {
</span><span style="color:#c0c5ce;">                &quot;</span><span style="color:#a3be8c;">width</span><span style="color:#c0c5ce;">&quot; =&gt; width = a.value.</span><span style="color:#96b5b4;">as_float</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">                &quot;</span><span style="color:#a3be8c;">height</span><span style="color:#c0c5ce;">&quot; =&gt; height = a.value.</span><span style="color:#96b5b4;">as_float</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// because Size only depends on the width and height, no other attributes will be passed to the member
</span><span style="color:#c0c5ce;">                _ =&gt; panic!(),
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// to determine what other parts of the dom need to be updated we return a boolean that marks if this member changed
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> changed = (width != </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) || (height != </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        *</span><span style="color:#bf616a;">self </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">Self</span><span style="color:#c0c5ce;">(width, height);
</span><span style="color:#c0c5ce;">        changed
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">derive</span><span style="color:#c0c5ce;">(Debug, Clone, Copy, PartialEq, Default, Component)]
</span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">TextColor {
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">r</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">u8</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">g</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">u8</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">u8</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">partial_derive_state</span><span style="color:#c0c5ce;">]
</span><span style="color:#b48ead;">impl </span><span style="color:#c0c5ce;">State </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">TextColor {
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// TextColor depends on the TextColor part of the parent
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ParentDependencies = (</span><span style="color:#b48ead;">Self</span><span style="color:#c0c5ce;">,);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ChildDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">NodeDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// TextColor only cares about the color attribute of the current node
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">NODE_MASK</span><span style="color:#c0c5ce;">: NodeMaskBuilder&lt;</span><span style="color:#b48ead;">&#39;static</span><span style="color:#c0c5ce;">&gt; =
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// Get access to the color attribute
</span><span style="color:#c0c5ce;">        NodeMaskBuilder::new().</span><span style="color:#96b5b4;">with_attrs</span><span style="color:#c0c5ce;">(AttributeMaskBuilder::Some(&amp;[&quot;</span><span style="color:#a3be8c;">color</span><span style="color:#c0c5ce;">&quot;]));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">update</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;(
</span><span style="color:#c0c5ce;">        &amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">node_view</span><span style="color:#c0c5ce;">: NodeView&lt;()&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_node</span><span style="color:#c0c5ce;">: &lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">NodeDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">parent</span><span style="color:#c0c5ce;">: Option&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ParentDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_children</span><span style="color:#c0c5ce;">: Vec&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ChildDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_context</span><span style="color:#c0c5ce;">: &amp;SendAnyMap,
</span><span style="color:#c0c5ce;">    ) -&gt; </span><span style="color:#b48ead;">bool </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// TextColor only depends on the color tag, so getting the first tag is equivalent to looking through all tags
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> new = </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> node_view
</span><span style="color:#c0c5ce;">            .</span><span style="color:#96b5b4;">attributes</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">            .</span><span style="color:#96b5b4;">and_then</span><span style="color:#c0c5ce;">(|</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">attrs</span><span style="color:#c0c5ce;">| attrs.</span><span style="color:#96b5b4;">next</span><span style="color:#c0c5ce;">())
</span><span style="color:#c0c5ce;">            .</span><span style="color:#96b5b4;">and_then</span><span style="color:#c0c5ce;">(|</span><span style="color:#bf616a;">attr</span><span style="color:#c0c5ce;">| attr.value.</span><span style="color:#96b5b4;">as_text</span><span style="color:#c0c5ce;">())
</span><span style="color:#c0c5ce;">        {
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// if there is a color tag, translate it
</span><span style="color:#c0c5ce;">            Some(&quot;</span><span style="color:#a3be8c;">red</span><span style="color:#c0c5ce;">&quot;) =&gt; TextColor { r: </span><span style="color:#d08770;">255</span><span style="color:#c0c5ce;">, g: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, b: </span><span style="color:#d08770;">0 </span><span style="color:#c0c5ce;">},
</span><span style="color:#c0c5ce;">            Some(&quot;</span><span style="color:#a3be8c;">green</span><span style="color:#c0c5ce;">&quot;) =&gt; TextColor { r: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, g: </span><span style="color:#d08770;">255</span><span style="color:#c0c5ce;">, b: </span><span style="color:#d08770;">0 </span><span style="color:#c0c5ce;">},
</span><span style="color:#c0c5ce;">            Some(&quot;</span><span style="color:#a3be8c;">blue</span><span style="color:#c0c5ce;">&quot;) =&gt; TextColor { r: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, g: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, b: </span><span style="color:#d08770;">255 </span><span style="color:#c0c5ce;">},
</span><span style="color:#c0c5ce;">            Some(color) =&gt; panic!(&quot;</span><span style="color:#a3be8c;">unknown color {}</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">red</span><span style="color:#c0c5ce;">&quot;),
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// otherwise check if the node has a parent and inherit that color
</span><span style="color:#c0c5ce;">            None =&gt; </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> parent {
</span><span style="color:#c0c5ce;">                Some((parent,)) =&gt; *parent,
</span><span style="color:#c0c5ce;">                None =&gt; </span><span style="color:#b48ead;">Self</span><span style="color:#c0c5ce;">::default(),
</span><span style="color:#c0c5ce;">            },
</span><span style="color:#c0c5ce;">        };
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// check if the member has changed
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> changed = new != *</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        *</span><span style="color:#bf616a;">self </span><span style="color:#c0c5ce;">= new;
</span><span style="color:#c0c5ce;">        changed
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">derive</span><span style="color:#c0c5ce;">(Debug, Clone, Copy, PartialEq, Default, Component)]
</span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">Border(</span><span style="color:#b48ead;">bool</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">partial_derive_state</span><span style="color:#c0c5ce;">]
</span><span style="color:#b48ead;">impl </span><span style="color:#c0c5ce;">State </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">Border {
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// TextColor depends on the TextColor part of the parent
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ParentDependencies = (</span><span style="color:#b48ead;">Self</span><span style="color:#c0c5ce;">,);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">ChildDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">NodeDependencies = ();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// Border does not depended on any other member in the current node
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">const </span><span style="color:#d08770;">NODE_MASK</span><span style="color:#c0c5ce;">: NodeMaskBuilder&lt;</span><span style="color:#b48ead;">&#39;static</span><span style="color:#c0c5ce;">&gt; =
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// Get access to the border attribute
</span><span style="color:#c0c5ce;">        NodeMaskBuilder::new().</span><span style="color:#96b5b4;">with_attrs</span><span style="color:#c0c5ce;">(AttributeMaskBuilder::Some(&amp;[&quot;</span><span style="color:#a3be8c;">border</span><span style="color:#c0c5ce;">&quot;]));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">update</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;(
</span><span style="color:#c0c5ce;">        &amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">node_view</span><span style="color:#c0c5ce;">: NodeView&lt;()&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_node</span><span style="color:#c0c5ce;">: &lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">NodeDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_parent</span><span style="color:#c0c5ce;">: Option&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ParentDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_children</span><span style="color:#c0c5ce;">: Vec&lt;&lt;</span><span style="color:#b48ead;">Self::</span><span style="color:#c0c5ce;">ChildDependencies as Dependancy&gt;::ElementBorrowed&lt;</span><span style="color:#b48ead;">&#39;a</span><span style="color:#c0c5ce;">&gt;&gt;,
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_context</span><span style="color:#c0c5ce;">: &amp;SendAnyMap,
</span><span style="color:#c0c5ce;">    ) -&gt; </span><span style="color:#b48ead;">bool </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// check if the node contains a border attribute
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> new = </span><span style="color:#b48ead;">Self</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">            node_view
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">attributes</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">and_then</span><span style="color:#c0c5ce;">(|</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">attrs</span><span style="color:#c0c5ce;">| attrs.</span><span style="color:#96b5b4;">next</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">map</span><span style="color:#c0c5ce;">(|</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">| a.attribute.name == &quot;</span><span style="color:#a3be8c;">border</span><span style="color:#c0c5ce;">&quot;))
</span><span style="color:#c0c5ce;">                .</span><span style="color:#96b5b4;">is_some</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">        );
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// check if the member has changed
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> changed = new != *</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        *</span><span style="color:#bf616a;">self </span><span style="color:#c0c5ce;">= new;
</span><span style="color:#c0c5ce;">        changed
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><p>Now that we have our state, we can put it to use in our RealDom. We can update the RealDom with apply_mutations to update the structure of the dom (adding, removing, and changing properties of nodes) and then update_state to update the States for each of the nodes that changed.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">app</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">cx</span><span style="color:#c0c5ce;">: Scope) -&gt; Element {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> count = </span><span style="color:#96b5b4;">use_state</span><span style="color:#c0c5ce;">(cx, || </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">use_future</span><span style="color:#c0c5ce;">(cx, (count,), |(</span><span style="color:#bf616a;">count</span><span style="color:#c0c5ce;">,)| async </span><span style="color:#b48ead;">move </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">loop </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">                tokio::time::sleep(std::time::Duration::from_secs(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)).await;
</span><span style="color:#c0c5ce;">                count.</span><span style="color:#96b5b4;">set</span><span style="color:#c0c5ce;">(*count + </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        });
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        cx.</span><span style="color:#96b5b4;">render</span><span style="color:#c0c5ce;">(rsx! {
</span><span style="color:#c0c5ce;">            div{
</span><span style="color:#c0c5ce;">                color: &quot;</span><span style="color:#a3be8c;">red</span><span style="color:#c0c5ce;">&quot;,
</span><span style="color:#c0c5ce;">                &quot;</span><span style="color:#a3be8c;">{count}</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        })
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// create the vdom, the real_dom, and the binding layer between them
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> vdom = VirtualDom::new(app);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> rdom: RealDom = RealDom::new([
</span><span style="color:#c0c5ce;">        Border::to_type_erased(),
</span><span style="color:#c0c5ce;">        TextColor::to_type_erased(),
</span><span style="color:#c0c5ce;">        Size::to_type_erased(),
</span><span style="color:#c0c5ce;">    ]);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> dioxus_intigration_state = DioxusState::create(&amp;</span><span style="color:#b48ead;">mut</span><span style="color:#c0c5ce;"> rdom);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> mutations = vdom.</span><span style="color:#96b5b4;">rebuild</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// update the structure of the real_dom tree
</span><span style="color:#c0c5ce;">    dioxus_intigration_state.</span><span style="color:#96b5b4;">apply_mutations</span><span style="color:#c0c5ce;">(&amp;</span><span style="color:#b48ead;">mut</span><span style="color:#c0c5ce;"> rdom, mutations);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> ctx = SendAnyMap::new();
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// set the font size to 3.3
</span><span style="color:#c0c5ce;">    ctx.</span><span style="color:#96b5b4;">insert</span><span style="color:#c0c5ce;">(FontSize(</span><span style="color:#d08770;">3.3</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// update the State for nodes in the real_dom tree
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> _to_rerender = rdom.</span><span style="color:#96b5b4;">update_state</span><span style="color:#c0c5ce;">(ctx);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// we need to run the vdom in a async runtime
</span><span style="color:#c0c5ce;">    tokio::runtime::Builder::new_current_thread()
</span><span style="color:#c0c5ce;">        .</span><span style="color:#96b5b4;">enable_all</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">        .</span><span style="color:#96b5b4;">build</span><span style="color:#c0c5ce;">()?
</span><span style="color:#c0c5ce;">        .</span><span style="color:#96b5b4;">block_on</span><span style="color:#c0c5ce;">(async {
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">loop </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// wait for the vdom to update
</span><span style="color:#c0c5ce;">                vdom.</span><span style="color:#96b5b4;">wait_for_work</span><span style="color:#c0c5ce;">().await;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// get the mutations from the vdom
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> mutations = vdom.</span><span style="color:#96b5b4;">render_immediate</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// update the structure of the real_dom tree
</span><span style="color:#c0c5ce;">                dioxus_intigration_state.</span><span style="color:#96b5b4;">apply_mutations</span><span style="color:#c0c5ce;">(&amp;</span><span style="color:#b48ead;">mut</span><span style="color:#c0c5ce;"> rdom, mutations);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// update the state of the real_dom tree
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> ctx = SendAnyMap::new();
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// set the font size to 3.3
</span><span style="color:#c0c5ce;">                ctx.</span><span style="color:#96b5b4;">insert</span><span style="color:#c0c5ce;">(FontSize(</span><span style="color:#d08770;">3.3</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> _to_rerender = rdom.</span><span style="color:#96b5b4;">update_state</span><span style="color:#c0c5ce;">(ctx);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// render...
</span><span style="color:#c0c5ce;">                rdom.</span><span style="color:#96b5b4;">traverse_depth_first</span><span style="color:#c0c5ce;">(|</span><span style="color:#bf616a;">node</span><span style="color:#c0c5ce;">| {
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> indent = &quot; &quot;.</span><span style="color:#96b5b4;">repeat</span><span style="color:#c0c5ce;">(node.</span><span style="color:#96b5b4;">height</span><span style="color:#c0c5ce;">() as </span><span style="color:#b48ead;">usize</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> color = *node.get::&lt;TextColor&gt;().</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> size = *node.get::&lt;Size&gt;().</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> border = *node.get::&lt;Border&gt;().</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> id = node.</span><span style="color:#96b5b4;">id</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> node = node.</span><span style="color:#96b5b4;">node_type</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> node_type = &amp;*node;
</span><span style="color:#c0c5ce;">                    println!(&quot;</span><span style="color:#d08770;">{indent}{id:?} {color:?} {size:?} {border:?} {node_type:?}</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">                });
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        })
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><h2 id="layout"><a class="header" href="#layout">Layout</a></h2><p>For most platforms, the layout of the Elements will stay the same. The <a href="https://docs.rs/dioxus-native-core/latest/dioxus_native_core/layout_attributes/index.html">layout_attributes</a> module provides a way to apply HTML attributes a <a href="https://docs.rs/taffy/latest/taffy/index.html">Taffy</a> layout style.</p><h2 id="text-editing"><a class="header" href="#text-editing">Text Editing</a></h2><p>To make it easier to implement text editing in rust renderers, <code>native-core</code> also contains a renderer-agnostic cursor system. The cursor can handle text editing, selection, and movement with common keyboard shortcuts integrated.</p><div style="position: relative;"><div><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">text_editing</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> cursor = Cursor::default();
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> text = String::new();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// handle keyboard input with a max text length of 10
</span><span style="color:#c0c5ce;">    cursor.</span><span style="color:#96b5b4;">handle_input</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">        &amp;Code::ArrowRight,
</span><span style="color:#c0c5ce;">        &amp;Key::ArrowRight,
</span><span style="color:#c0c5ce;">        &amp;Modifiers::empty(),
</span><span style="color:#c0c5ce;">        &amp;</span><span style="color:#b48ead;">mut</span><span style="color:#c0c5ce;"> text,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">    );
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// manually select text between characters 0-5 on the first line (this could be from dragging with a mouse)
</span><span style="color:#c0c5ce;">    cursor.start = Pos::new(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    cursor.end = Some(Pos::new(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// delete the selected text and move the cursor to the start of the selection
</span><span style="color:#c0c5ce;">    cursor.</span><span style="color:#96b5b4;">delete_selection</span><span style="color:#c0c5ce;">(&amp;</span><span style="color:#b48ead;">mut</span><span style="color:#c0c5ce;"> text);
</span><span style="color:#c0c5ce;">}
</span></pre>
</div><button style="position: absolute; top: 0; right: 0; background: rgba(0, 0, 0, 0.75); color: white; border: 1px solid white; padding: 0.25em;" onclick="navigator.clipboard.writeText(this.previousElementSibling.innerText)">Copy</button></div><h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2><p>That should be it! You should have nearly all the knowledge required on how to implement your renderer. We&#x27;re super interested in seeing Dioxus apps brought to custom desktop renderers, mobile renderers, video game UI, and even augmented reality! If you&#x27;re interested in contributing to any of these projects, don&#x27;t be afraid to reach out or join the <a href="https://discord.gg/XgGxMSkvUM">community</a>.</p><script></script></article></div></div></section><div class="overflow-y-auto hidden xl:block sticky top-28 pl-3.5 -ml-3.5 w-60 h-full md:text-[13px] leading-5 text-navy docs-right-sidebar " style="left:calc(100vw - 15rem);"><h2 class="pb-4 font-semibold">On this page</h2><ul class=""><li class="pb-2 pl-2"><a href="?phantom=custom-renderer#custom-renderer"><!--#-->Custom Renderer<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=the-specifics:#the-specifics:"><!--#-->The specifics:<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=templates#templates"><!--#-->Templates<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=mutations#mutations"><!--#-->Mutations<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=node-storage#node-storage"><!--#-->Node storage<!--#--></a></li><li class="pb-2 pl-6"><a href="?phantom=an-example#an-example"><!--#-->An Example<!--#--></a></li><li class="pb-2 pl-8"><a href="?phantom=building-templates#building-templates"><!--#-->Building Templates<!--#--></a></li><li class="pb-2 pl-8"><a href="?phantom=applying-mutations#applying-mutations"><!--#-->Applying Mutations<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=event-loop#event-loop"><!--#-->Event loop<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=custom-raw-elements#custom-raw-elements"><!--#-->Custom raw elements<!--#--></a></li><li class="pb-2 pl-2"><a href="?phantom=native-core#native-core"><!--#-->Native Core<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=the-realdom#the-realdom"><!--#-->The RealDom<!--#--></a></li><li class="pb-2 pl-6"><a href="?phantom=example#example"><!--#-->Example<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=layout#layout"><!--#-->Layout<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=text-editing#text-editing"><!--#-->Text Editing<!--#--></a></li><li class="pb-2 pl-4"><a href="?phantom=conclusion#conclusion"><!--#-->Conclusion<!--#--></a></li></ul><h2 class="py-4 font-semibold"><a href="https://github.com/DioxusLabs/docsite">Edit this page!</a></h2><h2 class="py-4 font-semibold">Go to version</h2><div class="pb-4"><ul class="pl-2"><li class="m-1 rounded-md pl-2 hover:bg-gray-200 hover:dark:bg-gray-800"><a href="/learn/0.3"><span class="material-icons material-icons-outlined material-icons-round material-icons-sharp material-icons-two-tone md-48" style="font-size: inherit; color: gray; user-select: none;"><!--#-->chevron_left<!--#--></span>0.3</a></li></ul></div></div></div></div><footer class="sticky z-30 text-gray-400 bg-ghmetal body-font "><div class="container px-5 py-24 mx-auto flex md:items-center lg:items-start md:flex-row md:flex-nowrap flex-wrap flex-col"><div class="w-64 flex-shrink-0 md:mx-0 mx-auto text-center md:text-left"><a class="flex title-font font-medium items-center md:justify-start justify-center text-white" href="https://github.com/DioxusLabs/dioxus"><img src="https://avatars.githubusercontent.com/u/79236386?s=200&v=4" class="h-8 w-auto" alt="Dioxus Labs Icon"/><span class="ml-3 text-xl">Dioxus Labs</span></a><p class="mt-2 text-sm text-gray-500">An Open Source project dedicated to making Rust UI wonderful.</p></div><div class="flex-grow flex flex-wrap md:pl-20 -mb-10 md:mt-0 mt-10 md:text-left text-center"><div class="lg:w-1/4 md:w-1/2 w-full px-4"><h2 class="title-font font-medium text-white tracking-widest text-sm mb-3"><!--#-->Community<!--#--></h2><nav class="list-none mb-10"><ul><li><a class="text-gray-400 hover:text-white" href="https://github.com/dioxuslabs"><!--#-->Github<!--#--></a></li><li><a class="text-gray-400 hover:text-white" href="https://twitter.com/dioxuslabs"><!--#-->Twitter<!--#--></a></li><li><a class="text-gray-400 hover:text-white" href="https://discord.gg/XgGxMSkvUM"><!--#-->Discord<!--#--></a></li></ul></nav></div><div class="lg:w-1/4 md:w-1/2 w-full px-4"><h2 class="title-font font-medium text-white tracking-widest text-sm mb-3"><!--#-->Learning<!--#--></h2><nav class="list-none mb-10"><ul><li><a class="text-gray-400 hover:text-white" href="https://docs.rs/dioxus"><!--#-->docs.rs<!--#--></a></li><li><a class="text-gray-400 hover:text-white" href="/learn/0.4/guide"><!--#-->Guide<!--#--></a></li><li><a class="text-gray-400 hover:text-white" href="/awesome"><!--#-->Awesome<!--#--></a></li></ul></nav></div><div class="lg:w-1/4 md:w-1/2 w-full px-4"><h2 class="title-font font-medium text-white tracking-widest text-sm mb-3"><!--#-->Projects<!--#--></h2><nav class="list-none mb-10"><ul><li><a class="text-gray-400 hover:text-white" href="https://github.com/DioxusLabs/dioxus"><!--#-->Dioxus<!--#--></a></li><li><a class="text-gray-400 hover:text-white" href="https://github.com/DioxusLabs/dioxus/tree/master/packages/cli"><!--#-->CLI<!--#--></a></li><li><a class="text-gray-400 hover:text-white" href="https://github.com/DioxusLabs/taffy"><!--#-->Taffy<!--#--></a></li></ul></nav></div></div></div><div class="container mx-auto py-4 px-5 flex flex-wrap flex-col sm:flex-row"><p class="text-gray-400 text-sm text-center sm:text-left">© 2023 Dioxus Labs —<a class="text-gray-500 ml-1" rel="noopener noreferrer" href="https://twitter.com/dioxuslabs" target="_blank">@dioxuslabs</a></p></div></footer></div><meta hidden="true" id="dioxus-storage-props" data-serialized="AQ==" /><meta hidden="true" id="dioxus-storage-data" data-serialized="AA==" /></div>
    <!-- Note the usage of `type=module` here as this is an ES6 module -->
    <script type="module">
      import init from "/./assets/dioxus/docsite.js";
      init("/./assets/dioxus/docsite_bg.wasm").then((wasm) => {
        if (wasm.__wbindgen_start == undefined) {
          wasm.main();
        }
      });
    </script>
    <script src="/static/prism/prism.js"></script>
    
  </body>
</html>
